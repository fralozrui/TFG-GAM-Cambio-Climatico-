---
author: "Nombre Completo Autor"
date: "27/10/2017"
documentclass: book
forprint: true  # true: imprime a dos caras, false: libro digital
fontsize: 12pt # 10pt,11pt
geometry: margin = 2.5cm 
bibliography: ["bib/library.bib", "bib/paquetes.bib"]
# metodobib -> true: natbib (descomentar: citation_package: natbib) 
#           -> false: pandoc (comentar: citation_package: natbib)
metodobib: true
#natbib: plainnat, abbrvnat, unsrtnat
biblio-style: "plainnat"
#Método 2 (pandoc): descomente una línea de las 2 siguientes en caso de usarlo
csl: methods-in-ecology-and-evolution.csl      # no numera mejor en las citas
#csl: acm-sig-proceedings-long-author-list.csl  # numera peor en las citas
link-citations: yes
output: 
  pdf_document:
    keep_tex: no
    number_sections: yes
    citation_package: natbib  # comentado usa: pandoc-citeproc
    #toc: yes
    fig_caption: yes
    template: latex/templateMemoriaTFE.tex
    includes:
      #before_body: portadas/latex_paginatitulo_modTFE.tex
      #in_header: latex/latex_preambulo.tex
      #after_body: latex/latex_antes_enddoc.tex
---



```{r include=FALSE}
knitr::opts_chunk$set(fig.path = 'figurasR/',
                      echo = FALSE, warning = FALSE, message = FALSE,
                      fig.pos="H",fig.align="center",out.width="95%",
                      cache=FALSE)

```


<!-- \setcounter{chapter}{2} -->
<!-- \setcounter{chapter}{2} escribir 2 para capítulo 3  -->
<!-- \pagenumbering{arabic} -->


\ifdefined\ifprincipal
\else
\setlength{\parindent}{1em}
\pagestyle{fancy}
\setcounter{tocdepth}{4}
\tableofcontents
<!-- \nocite{*} -->
\fi

\ifdefined\ifdoblecara
\fancyhead{}{}
\fancyhead[LE,RO]{\scriptsize\rightmark}
\fancyfoot[LO,RE]{\scriptsize\slshape \leftmark}
\fancyfoot[C]{}
\fancyfoot[LE,RO]{\footnotesize\thepage}
\else
\fancyhead{}{}
\fancyhead[RO]{\scriptsize\rightmark}
\fancyfoot[LO]{\scriptsize\slshape \leftmark}
\fancyfoot[C]{}
\fancyfoot[RO]{\footnotesize\thepage}
\fi
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}

# Apéndice: Representaciones gráficas {#Apendice2}

**Representaciones de la primera aplicación** $\ref{Descripcion1}$


```{r,echo=TRUE,eval=FALSE}
par(mfrow = c(2, 2))
plot(mag1, select = 1, main = 'Humedad Relativa', shade = TRUE)
plot(mag1, select = 2, main = 'Presion', shade = TRUE)
plot(mag1, select = 3, main = 'Precipitaciones totales', shade = TRUE)
plot(mag1, select = 4, main = 'Velocidad media del viento', shade = TRUE)
par(mfrow = c(1, 1))
```

```{r,echo=TRUE,eval=FALSE, warning=FALSE}
Julio <- filter(Clima, Clima$Mes == 7)
Julio$Preds <- predict(mag1, newdata = Julio)
Julio <- Julio[complete.cases(Julio$Preds),]

lm1 <- gam(TMedM ~ Año,data = Julio)
Julio$LPreds <- predict(lm1,Julio)

library(ggplot2)
ggplot(Julio,aes(x=Año))+
  geom_point(aes(y=TMedM),size=1.5, col = 'black')+
  theme_minimal()+
  geom_line(aes(y=Preds, color = 'MAG'),linewidth=1)+
  geom_line(aes(y=LPreds, color = 'ML'),linewidth=0.6)+
  labs(title ="Temperatura media mensual del mes de Julio",x="Año",
       y="Temperatura ºC")+
  scale_color_manual(values = c('MAG' = 'darkred', 'ML' = '#EB6146'),
                     name = "Leyenda") + 
  theme(axis.title = element_text(face = "bold"),
        legend.text = element_text( size = 10,colour = "black"),
        legend.position = 'right')
```

**Representaciones de la segunda aplicación** $\ref{Descripicion2}$

```{r,echo=TRUE,eval=FALSE}
predsc <- exp(predict(magCO2c,CO2))

lmCO2 <- gam(Tmes ~ Año, )

ggplot(CO2, aes(x = Año, y = Tmes)) +
  geom_point(size = 2) + 
  geom_line(aes(y = predsc), color = "darkgreen", linewidth = 1.2) + 
  labs(x = "Años",y = "ppm", title = "Concentración mensual media de dióxido de carbono (ppm)") +
  theme_minimal()

```

```{r,echo=TRUE,eval=FALSE}

futuro = CO2[1:324,1:2]
s <- c()
new <- function(x){
  for (i in x){
    for (j in 1:12){
      s <- append(s,i)
    }
  }
s}
futuro$Año <- new(2024:2050)

futuro$Tmes <- sqrt(1/predict(magCO2b,futuro))
futuro$Trend <- 1:324 == NA
futuro$col <- 'Predicciones' 

pasado <- CO2
pasado$col <- 'Datos'
df <- rbind(pasado,futuro)

ggplot(df, aes(x = Año, y = Tmes)) +
  geom_line(aes(color = col, group = 1), linewidth = 1) +
  geom_vline(aes(xintercept = 2024), color = 'black',, linetype = "dashed" , linewidth = 0.5)+
  labs(x = "Años",y = "ppm", title = "Concentración mensual media de dióxido de carbono",
       legend = c('Datos','Predicciones')) +
  scale_color_manual(values = c('Datos' = 'darkgreen', 'Predicciones' = 'darkred'), name = "Leyenda")+
  theme(axis.title = element_text(face = "bold"),
        legend.text = element_text(size = 10,color = 'black'),
        legend.position = 'right')
```


```{r, echo=TRUE,eval=FALSE}
magCH4 <- gam(Trend ~ s(Año) + as.numeric(Mes), data = CH4, family = Gamma(link = "log"))

magN2O <- gam(Trend ~ s(Año) + Mes, data = N2O, family = Gamma(link = "log"))


predsCH4 <- exp(predict(magCH4,CH4))
predsN2O <- exp(predict(magN2O,N2O))

par(mfrow = c(1,2))

ggplot(CH4, aes(x = Año, y = Trend)) +
  geom_point(size = 2) + 
  geom_line(aes(y = predsCH4), color = "darkorange2", linewidth = 1.2) + 
  labs(x = "Años",y = "ppb", title = "Concentración mensual media de metano") +
  theme_minimal()

ggplot(N2O, aes(x = Año, y = Trend)) +
  geom_point(size = 2) + 
  geom_line(aes(y = predsN2O), color = "deepskyblue2", linewidth = 1.2) + 
  labs(x = "Años",y = "ppb", title = "Concentración mensual media de óxido nitroso") +
  theme_minimal()

par(mfrow = c(1,1))

```


**Representaciones de la tercera aplicación** $\ref{Descripcion3}$


```{r,echo=TRUE,eval=FALSE}
par(mfrow = c(2, 2))
plot(magSL, select = 1, main = 'Temperatura', shade = TRUE)
plot(magSL, select = 2, main = 'Concentración de CO2', shade = TRUE)
plot(magSL, select = 3, main = 'Años', shade = TRUE)
par(mfrow = c(1, 1))
```

```{r,echo=TRUE,eval=FALSE}
Julio <- Sea[Sea$Mes == 7,]
Julio$preds <- predict(magSL, newdata = Julio)
Julio$preds3 <- predict(magSL3, newdata = Julio)

ggplot(data = Julio, aes(x = Año, y = GMSL)) +
  geom_point() +
  geom_line(aes(x = Año, y = preds, color = 'Mod. sin int.'), linewidth = 1) +
  geom_line(aes(x = Año, y = preds3, color = 'Mod. con int.'),  linewidth = 1) +
  labs(x = "Años", y = "mm", 
       title = "Comparación de modelos para GMSL") +
  scale_color_manual(values = c('Mod. sin int.'= "darkblue", 'Mod. con int.' = "lightblue"), name = 'Leyenda') +
  theme_minimal()

```

```{r,echo=TRUE,eval=FALSE,warning=FALSE}

SeaTpreds <- (SeaT[(2015 <= SeaT$Año),])[1:112,]
CO2preds <-  CO2[(2015 <= CO2$Año),]

Seapreds <- cbind(SeaTpreds,CO2preds)
Seapreds <- Seapreds[,c(1,2,3,6)]
colnames(Seapreds) <- c('Año','Mes','Temp','CO2')

na_rows <- as.data.frame(matrix(NA, nrow = 112, ncol = ncol(Sea)))
colnames(na_rows) <- colnames(Sea)

SeaP <- rbind(Sea, na_rows)

SeaP$preds <- append(1:672 == NA,predict(magSL,Seapreds))
SeaP$preds3 <- append(1:672 == NA,predict(magSL3,Seapreds))
SeaP$Año <- append(Sea$Año,Seapreds$Año) 
SeaP$Mes <- append(Sea$Mes,Seapreds$Mes) 
SeaP$GMSL <- append(SeaL$GMSL[(1959 <= SeaL$Año)],rep(NA, 16))

ggplot(data = SeaP, aes(x = Año, y = GMSL)) +
  geom_line(aes(x = Año, y = GMSL , color = 'Datos'), linewidth = 1) + 
  geom_line(aes(x = Año, y = preds, color = 'Mod. sin int.'), linewidth = 1) +
  geom_line(aes(x = Año, y = preds3, color = 'Mod. con int.'),  linewidth = 1) +
  labs(x = "Años", y = "mm", title = "Predicciones de la media global del nivel del mar") +
  geom_vline(aes(xintercept = 2015), color = 'black',, linetype = "dashed" , linewidth = 0.5)+
  scale_color_manual(values = c('Datos' = 'lightgreen', 'Mod. sin int.' = 'darkblue','Mod. con int.' = 'lightblue'), name = "Leyenda")+
  theme(axis.title = element_text(face = "bold"),
        legend.text = element_text(size = 10,color = 'black'),
        legend.position = 'right')

```